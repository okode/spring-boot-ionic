branches:
  only:
  - master
  - develop
language: java
jdk:
- oraclejdk8
addons:
  apt:
    sources:
    - sourceline: deb https://dl.yarnpkg.com/debian/ stable main
      key_url: https://dl.yarnpkg.com/debian/pubkey.gpg
    packages:
    - yarn
env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: eRDmzkmMacmghNuC/c7772tkCSDRnqRZ6CYAArks53kH9AJr6cYZD3boKZotvoUot4fDOAXpC6jUd3v4D3+9UOwZPv8seAJnxI37SOY6hptyioclIBheDVR2wcM/unIqkq3fCJwaHVDf7jlM3FtWbtw56uu+qCOwr826GyxZ0fo6fcnuY36gzZThqDD9WZ7mt0NfZqvSJWG04kOir91V0Rfh+hdCGBkNFIw4Olbm6EJed9bOqpJ2sr5GH+Ytug5u/2f1HIbFHk+Ms87mdESKwrTDxKr9AcUv8ZxJCaSVlDuSXlsSWQpVxff/CrX0ZlqebEBX7EBk9dlZvOO+3xonknSGwYufBFp9S3BRPZP8RDNPWaKmZsQXUY2fHn/XZHbww61fKvy8IloY/aL9PDXU/9cRV/El+x4eZuPlkob+QppOsEFa57OsJSct2b/DoA3+kvOFNcj00xGy4F/iz7jwd6JghNBdY2B8X9WIWxaRjcCaAeuDyxlm9XV2X+ZkpeXQUTwXUolLt/nIqm4A4KDIWUHgt4OLcvnnNmpxhLGBEGNQjOmgBPyeV1W2PKA5ShP6TgPAEJlH5NSLtYyGHinwogPFhO/a7r4+NW0fCb67iPXegTBMBkilS3X8hkVqVHA3Er2DfQp4bc8lp/CY4AvO3i6MCnWEc7Un7Tmu2S8TrlM=
before_install:
- export LANG=en_US.UTF-8
- echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
- nvm install 7
- npm install -g ionic cordova
script:
- cd frontend && yarn install && ionic platform add browser && ionic build browser
  --prod --release && cd ..
- cd backend && cp -Rv ../frontend/www/* src/main/resources/static && ./gradlew bootRepackage && cd ..
deploy:
  provider: releases
  api_key:
    secure: TIw7HfhFjL3I+cTuP5sVqWh4QNHZOOKAna9O2zmPZnpy+z+GHYHyVvrpsIce7f/A+7LT72geFrICLJCs4QISZfd3u1XLVRr2wz2SAHYqqkufx6A0ShDytrHhwZs3e+d8CSFamMuNbIGmacxpLTy20txwEGHoTrmiA7tzagFRPUAXtKwirF2JwDmD8dNZ+cWbahF4hArwfN67xDnuRXNiQV5o4yslVOEzygOvfrD38ZbGjPZRWuWC1/kCkSBUC26j4MG0WpTqp3t2DVb5RAuNCEFpr/ejRwmmTHDaKQtnZByFzJq2OiF/F06TCfZC0FGR3QpxLb0WL4W5b5iDqiYUIhmXjElaegUc8BnM7whd1bGUYEVBacGf7d8+/2CLY7ix3Rdrz/nFMUryuWup1qmKgliMlUEnRKNgIYBL3X9COzz7J5FLyx3iFlmUgxKrtNS83OxfEdpoPkH6uqd8szz3kimyEyix/5PhTvYJwzzkNPQeITz80Oev/7oPJGgLsIqEl+nIgIkaakkwDxy40CynXv/HFiT/LGMYJuTe+S2hJ/DT1r4aP457kljLL3b9Iw8y53MGDoSB5rzhc6/uzHHMWMi6GHDUf4IPlrlbbKbIFU5UEswOXem3j88FQlcq0Pqrmd9qRsMf1wEhYD590kl2gEqbxR++h0oK+Q+3EUFBmkw=
  file_glob: true
  file: backend/build/libs/*.war
  skip_cleanup: true
  overwrite: true
  on:
    branch: master
addons:
  coverity_scan:
    project:
      name: "okode/spring-boot-ionic"
      description: "Spring Boot backend with Ionic2 frontend"
    notification_email: developers@okode.com
    build_command_prepend: "cd backend && ./gradlew clean && cd .."
    build_command: "cd backend && ./gradlew build && cd .."
    branch_pattern: develop